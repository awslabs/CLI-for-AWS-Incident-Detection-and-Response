service_name: "EKS" # Address separately for https://repost.aws/articles/ARhnAXjQGMSr2l2_qb_J8uaA

templates:
  # Option 1 - Container Insights (AWS Service) - Container Status Metrics
      - name: "IDR-EKS-container_crash_loop_back_off"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers stuck in CrashLoopBackOff"
        configuration:
          AlarmName: "IDR-EKS-container_crash_loop_back_off-${cluster_name}"
          MetricName: "pod_container_status_waiting_reason_crash_loop_back_off"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-container_create_container_config_error"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers with CreateContainerConfigError"
        configuration:
          AlarmName: "IDR-EKS-container_create_container_config_error-${cluster_name}"
          MetricName: "pod_container_status_waiting_reason_create_container_config_error"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-container_create_container_error"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers with CreateContainerError"
        configuration:
          AlarmName: "IDR-EKS-container_create_container_error-${cluster_name}"
          MetricName: "pod_container_status_waiting_reason_create_container_error"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-container_image_pull_error"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers with image pull errors"
        configuration:
          AlarmName: "IDR-EKS-container_image_pull_error-${cluster_name}"
          MetricName: "pod_container_status_waiting_reason_image_pull_error"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-container_start_error"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers with start errors"
        configuration:
          AlarmName: "IDR-EKS-container_start_error-${cluster_name}"
          MetricName: "pod_container_status_waiting_reason_start_error"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 1 - Container Insights (AWS Service) - Cluster Status Metrics
      - name: "IDR-EKS-cluster_failed_node_count"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors failed worker nodes in the EKS cluster"
        configuration:
          AlarmName: "IDR-EKS-cluster_failed_node_count-${cluster_name}"
          MetricName: "cluster_failed_node_count"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 1 - Container Insights (AWS Service) - Pod Status Metrics
      - name: "IDR-EKS-pod_status_unknown"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors pods with unknown status"
        configuration:
          AlarmName: "IDR-EKS-pod_status_unknown-${cluster_name}"
          MetricName: "pod_status_unknown"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 1 - Container Insights (AWS Service) - API Server Status Metrics
      - name: "IDR-EKS-apiserver_admission_webhook_admission_duration_seconds"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors admission webhook latency"
        configuration:
          AlarmName: "IDR-EKS-apiserver_admission_webhook_admission_duration_seconds-${cluster_name}"
          MetricName: "apiserver_admission_webhook_admission_duration_seconds"
          Namespace: "ContainerInsights"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 2 - Prometheus Integration - API Server Status (Prometheus)
      - name: "IDR-EKS-apiserver_admission_controller_admission_duration_seconds"
        service: "EKS"
        alarm_type: "PROACTIVE"
        description: "Monitors admission controller latency"
        configuration:
          AlarmName: "IDR-EKS-apiserver_admission_controller_admission_duration_seconds-${cluster_name}"
          MetricName: "apiserver_admission_controller_admission_duration_seconds"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Proactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-apiserver_authorization_webhook_duration_seconds"
        service: "EKS"
        alarm_type: "PROACTIVE"
        description: "Monitors authorization webhook duration"
        configuration:
          AlarmName: "IDR-EKS-apiserver_authorization_webhook_duration_seconds-${cluster_name}"
          MetricName: "apiserver_authorization_webhook_duration_seconds"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Proactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-apiserver_clusterip_repair_ip_errors_total"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors cluster IP repair errors"
        configuration:
          AlarmName: "IDR-EKS-apiserver_clusterip_repair_ip_errors_total-${cluster_name}"
          MetricName: "apiserver_clusterip_repair_ip_errors_total"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Sum"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-apiserver_nodeport_repair_port_errors_total"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors node port repair errors"
        configuration:
          AlarmName: "IDR-EKS-apiserver_nodeport_repair_port_errors_total-${cluster_name}"
          MetricName: "apiserver_nodeport_repair_port_errors_total"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Sum"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 2 - Prometheus Integration - Cluster Status (Prometheus)
      - name: "IDR-EKS-kubelet_started_containers_errors_total"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors container start errors"
        configuration:
          AlarmName: "IDR-EKS-kubelet_started_containers_errors_total-${cluster_name}"
          MetricName: "kubelet_started_containers_errors_total"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Sum"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-kubelet_runtime_operations_errors_total"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors kubelet runtime operation errors"
        configuration:
          AlarmName: "IDR-EKS-kubelet_runtime_operations_errors_total-${cluster_name}"
          MetricName: "kubelet_runtime_operations_errors_total"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Sum"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-kubelet_started_pods_errors_total"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors pod start errors"
        configuration:
          AlarmName: "IDR-EKS-kubelet_started_pods_errors_total-${cluster_name}"
          MetricName: "kubelet_started_pods_errors_total"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Sum"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-node_collector_zone_health"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors node health percentage per zone"
        configuration:
          AlarmName: "IDR-EKS-node_collector_zone_health-${cluster_name}"
          MetricName: "node_collector_zone_health"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 3 - Customer Managed Kubernetes - Alertmanager Status
      - name: "IDR-EKS-AlertmanagerClusterDown"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Alertmanager cluster availability"
        configuration:
          AlarmName: "IDR-EKS-AlertmanagerClusterDown-${cluster_name}"
          MetricName: "AlertmanagerClusterDown"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 3 - Customer Managed Kubernetes - Prometheus Status
      - name: "IDR-EKS-PrometheusNotConnectedToAlertmanagers"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Prometheus connection to Alertmanagers"
        configuration:
          AlarmName: "IDR-EKS-PrometheusNotConnectedToAlertmanagers-${cluster_name}"
          MetricName: "PrometheusNotConnectedToAlertmanagers"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-PrometheusBadConfig"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Prometheus configuration issues"
        configuration:
          AlarmName: "IDR-EKS-PrometheusBadConfig-${cluster_name}"
          MetricName: "PrometheusBadConfig"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

  # Option 3 - Customer Managed Kubernetes - Kubernetes Status
      - name: "IDR-EKS-KubeAPIDown"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Kubernetes API server availability"
        configuration:
          AlarmName: "IDR-EKS-KubeAPIDown-${cluster_name}"
          MetricName: "KubeAPIDown"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubeContainerWaiting"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors containers in waiting state"
        configuration:
          AlarmName: "IDR-EKS-KubeContainerWaiting-${cluster_name}"
          MetricName: "KubeContainerWaiting"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubeControllerManagerDown"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Kubernetes Controller Manager availability"
        configuration:
          AlarmName: "IDR-EKS-KubeControllerManagerDown-${cluster_name}"
          MetricName: "KubeControllerManagerDown"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubePodCrashLooping"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors pods in crash loop state"
        configuration:
          AlarmName: "IDR-EKS-KubePodCrashLooping-${cluster_name}"
          MetricName: "KubePodCrashLooping"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubeNodeNotReady"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Kubernetes nodes not in ready state"
        configuration:
          AlarmName: "IDR-EKS-KubeNodeNotReady-${cluster_name}"
          MetricName: "KubeNodeNotReady"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubeletDown"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors Kubelet availability"
        configuration:
          AlarmName: "IDR-EKS-KubeletDown-${cluster_name}"
          MetricName: "KubeletDown"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]

      - name: "IDR-EKS-KubeletTooManyPods"
        service: "EKS"
        alarm_type: "REACTIVE"
        description: "Monitors nodes running too many pods"
        configuration:
          AlarmName: "IDR-EKS-KubeletTooManyPods-${cluster_name}"
          MetricName: "KubeletTooManyPods"
          Namespace: "ContainerInsights/Prometheus"
          Statistic: "Average"
          Period: 60
          EvaluationPeriods: 5
          DatapointsToAlarm: 5
          Threshold: 1.0
          ComparisonOperator: "GreaterThanOrEqualToThreshold"
          TreatMissingData: "notBreaching"
          Dimensions: [
            {
              Name: "ClusterName",
              Value: "${cluster_name}"
            }
          ]
        Tags: [
          {
            Key: "AlarmType",
            Value: "Reactive"
          },
          {
            Key: "Service",
            Value: "EKS"
          }
        ]
